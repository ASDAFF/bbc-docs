# Примеры

Рассмотрим несколько примеров, демонстрирующих некоторые возможности ББК. В качестве примера будем считать, что ББК размещён в зоне `bbc`, а наши тестовые — в зоне `test`.

## «Мой первый компонент»

Разработаем тестовый компонент, производящий абстрактные операции (какие именно — не суть). Назовём его `List`.

Создайте каталог компонента и разместите в нём файл `class.php`:

```php
<?php

// Для разграничения и лаконичности имён классов добавим нэйм-спейс своих компонентов,
// будто бы они располагаются в каталоге /local/components/supersite/
namespace Vasya\Supersite\Components;

use Expert\Bbc\Components\Basis;

if(!defined('B_PROLOG_INCLUDED')||B_PROLOG_INCLUDED!==true)die();

// Подключаем компонент, от которого будем наследоваться
\CBitrixComponent::includeComponentClass('bbc:basis');

class List extends Basis
{
    
}
```

Наш компонент отнаследован от компонента `basis`. Таким образом, мы получили базовый функционал ББК: кеширование, обработку аякс-запросов, проверку и приведение параметров и многое другое.

Но сейчас компонент не производит никаких операций.  Исправим это. У всех компонентов, отнаследованных от базовых, есть [три точки входа](#Архитектура) (методы, которые можно переназначить для записи своей логики). Научим компонент складывать два числа, передаваемые ему через параметры (в данном примере создание конфигурационного файла `.parameters.php` не рассматривается). 

Сделаем так, что бы результат работы компонента кешировался, а не исполнялся на каждом хите. Для этого достаточно передать компоненту параметры `CACHE_TYPE = A` и `CACHE_TIME > 0`, после чего результаты работы метода `executeMain()` будут закешированы.

Т. к. нет необходимости в выполнении этого алгоритма на каждом хите, его можно закешировать. ББК сделает это автоматически.

```php
<?php

class List extends Basis
{
    protected function executeMain()
    {
	    $this->arResult['SUM'] = $this->arParams['NUM_1'] + $this->arParams['NUM_2'];
    }
}
```

Теперь сделаем так, что бы на каждом хите генерировалось случайное число, которое можно будет вывести в шаблоне компонента. В нашем распоряжении есть два метода: `executeProlog()` и `executeEpilog()`. Последний выполняется уже после подключения шаблона и, соответственно, отпадает. Переназначим `executeProlog()` (он выполняется перед методом `executeMain()` и не кешируется):

```php
<?php

class List extends Basis
{
	protected function executeProlog()
	{
		$this->arResult['RANDOM_NUMBER'] = rand();
	}
	
	protected functions executeMain()
    {
	    $this->arResult['SUM'] = $this->arParams['NUM_1'] + $this->arParams['NUM_2'];
    }
}
```

## Расширяем компоненты elements

Кроме описанных выше способов внедрения в родительский класс, компоненты `elements.list` и `elements.detail` предоставляют дополнительный метод, вызываемый на каждой итерации цикла возвращаемых результатов — `prepareElementsResult($element)`.

Для чего это нужно? Рассмотрим пример с компонентом `elements.list`. Пусть на сайте выводится список элементов инфоблока, и есть необходимость в модификации результатов выборки из инфоблока.

1. Добавим к каждому элементу инфоблока дополнительный ключ с абстрактными данными.
1. Если описание элемента пустое, будем пропускать итерацию (это решается фильтрами в запросе данных, но для примера сойдёт).

```php
<?php

namespace Vasya\Supersite\Components;

use Expert\Bbc;

if(!defined('B_PROLOG_INCLUDED')||B_PROLOG_INCLUDED!==true)die();

\CBitrixComponent::includeComponentClass('bbc:elements.list');

class ElementsList extends Bbc\Components\ElementsList
{
	// $element — это массив конкретного элемента инфоблока, возвращаемый в результате
	// выборки из инфоблока. Метод вызывается непосредственно перед записью жлемента
	// в $this->arResult['ELEMENTS']
    public function prepareElementsResult($element)
    {
	    // Добавляем дополнительный ключ с данными в массив конкретного элемента
        $element['TEST_DATA'] = 'Какие-то данные…';

		if (!$element['DETAIL_TEXT'])
		{
			// Детального описания нет, пропустим итерацию.
			return false;
		}

        return $element;
    }
}
```