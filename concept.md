# Архитектура

Базовые битриксовые компоненты построены на использовании [исключений](http://php.net/manual/ru/language.exceptions.php). Блок работы с исключениями (try … catch) располагается в методе `executeComponent()`, что охватывает практически все точки взаимодействия с логикой компонента (кроме метода `onPrepareComponentParams()`).

Базовые компоненты предоставляют дочерним классам три основные точки входа, методы, которые можно переопределить для создания индивидуальной логики компонента:

1. `executeProlog()` — выполняется в начале работы компонента, после подключения модулей, установки параметров и заголовков. Результаты метода не кешируются.
1. `executeMain()` — основная логика компонента, все ключевые операции производятся в этом методе. Если в параметрах компонента передан ключ `CACHE_TYPE` не равный «N», результаты метода будут закешированы.
1. `executeEpilog()` — выполняется после подключения шаблона компонента. Результаты не кешируются.

Ключевой метод всех компонентов:

```php
<?php

public function executeComponent()
{
   try {
       $this->executeBasis();
   }
   catch (\Exception $e)
   {
       $this->catchException($e);
   }
}
```

<aside class="warning">
Переназначение метода executeComponent() допускается только с целью добавления учёта дополнительных исключений. Во избежание нарушения целостности и несоблюдения архитектуры ББК запрещено производить какие-либо иные модификации логики этого метода.
</aside>

Как видно из примера выше, в начале работы компонента вызывается метод `executeBasis()` — основа ББК — выполняющий последовательность действий по обеспечению работы компонента.

Рассмотрим структуру базового компонента в порядке его выполнения.

Метод | Комментарий
-------------- | -------------- | --------------
`onPrepareComponent()` | Приведение параметров компонента.
`executeComponent()` | Основной метод компонента, реализующий инициализацию ББК и перехват исключений.
`includeModules()` | Подключение модулей, указанных в свойстве needModules класса компонента.
Автоматическая проверка и приведение параметров, перечисленных в свойстве $checkParams класса компонента. | 
`checkParams()` | Предназначен для собственных проверок параметров компонента. Метод-болванка.
Сброс буфера вывода и установка необходимых заголовков, если к компоненту обращается аякс-запрос. | 
Выполнение прологов типажей. | 
`executeProlog()` | Пролог компонента.
`executeMain()` | Основная логика компонента. Кешируется.
`returnDatas()` | Подключение шаблона компонента. По-умолчанию шаблон так же кешируется. Для отключения кеширования в классе компонента необходимо присвоить свойству cacheTemplate значенение false.
Выполнение эпилогов типажей. | 
`executeEpilog()` | Эпилог компонента.
Остановка выполнения страницы, если к компоненту обращается аякс-запрос. |

<aside class="notice">
Метод-болванка — пустой метод, переназначая который не нужно вызывать версию родительского класса.
</aside>

## Обработка исключений

Как вы могли заметить из примеров выше, обработку выброшенных исключений осуществляет метод `catchException($e)`: он принимает решение о том, какое сообщение об ошибке показать пользователю и нужно ли отправлять администратору сайта сообщение об этой ошибке.

Вывод сообщений для обычных пользователей и администраторов различаются. Обычным пользователям выводится простое сообщение о том, что на сервере произошла ошибка (метод `showExceptionUser()`). Администраторы же получают полное сообщение об ошибке с дебагом выброшенного исключений (метод `showExceptionAdmin()`).